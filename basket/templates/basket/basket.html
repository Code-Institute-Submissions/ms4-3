{% extends "base.html" %}
{% load static %}

{% block content %}


                <hr>
                <h2 class="logo-font mb-4">Shopping Bag</h2>
                <hr>
     
{% if basket_items %}      
     {% for item in basket_items %}

    <div class="container basket-container">

    
     <div class="row">
            <div class="col-12">
                <p>{{ item.product.friendly_name}}</p>
            </div>
        </div>
        <div class="row">
            <div class="col-10">
                <img class="img-fluid rounded thumbnail" src="{{ item.product.image_url_mobile }}">
            </div>
            <div class="col-2" >
                <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#basketModal{{item.item.basket_item_id}}">
   <i class="fas fa-ellipsis-v"></i>
</button>
           
            </div>
        </div>
       
                <div class="row">
                    
                     <div class="col-6">
                           <p class="basket-info">Qty: {{ item.item.quantity }}</p>
                        </div>
                </div>
               
                <div class="row">
                    <div class="col-6">
                        <p class="basket-info">SKU: {{ item.product.sku|upper }}</p>
                    </div>
                    <div class="col-6">
                        <p class="basket-info">Price: £{{ item.product.discount_price }}</p>
                    </div>
                    
                </div>
                <div class="row">
                    <div class="col-6">
                        <p class="basket-info">Digital photo? {{ item.digital_download }}</p>
                    </div>
                   
                    <div class="col-6">
                        <p class="basket-info">Sub-total: £{{ item.subtotal }}</p>
                    </div>
                    
                </div>
                 {% if item.product.product_type == 'container' %}
                <div class="row linked-products-basket-wrapper">
                    <div class="col-12">
                        <p>Linked Products</p>
                    </div>
                    <div class="col-12">
                        <div class="row">
                        {%for g in item.item.linked_products%}
                                        {% if g != 'Not linked' %}
                                            {% if g != 'Not available' %}
                                        <div class="col-4 linked-products-div">
                                            <p>{{g}}</p>
                                        </div>
                                        {% endif %}
                                        {% endif %}
                                        {% endfor %}
                        </div>
                    </div>
                </div>
                {% endif %}
                
        </div>

    <!-- Edit basket Modal -->
<div class="modal fade" id="basketModal{{item.item.basket_item_id}}" tabindex="-1" role="dialog" aria-labelledby="basketModal{{item.item.basket_item_id}}" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div id="editBasketHeader" class="modal-header editBasketBodyTrigger">
        <h5 class="modal-title " id="exampleModalLabel"><i class="fas fa-edit"></i> Edit Basket Item <i class="fas fa-chevron-down"></i></h5>
      </div>
      <div id="editBasketModalBody" class="modal-body editBasketBody hide">
           <form method="POST" action="{% url 'edit_basket' %}">
            {% csrf_token%}
          <h3>quantity</h3>
          <!-- <div class="input-group">
                <input id="basket-item-quantity{{ forloop.counter0}}" class="form-control qty_input" type="number" name="basket_quantity" value="{{item.item.quantity}}" min="0" max="99" data-item_id="" >
            </div> -->
             <div class="input-group">
                                      <button class="btn" data-item_id="{{ item.item_id }}" id="decreaseProductDetailQuantity">
                                                            <span>
                                                                <i class="fas fa-minus fa-sm"></i>
                                                            </span>
                                                        </button>  
                               
                                        <input class="form-control qty_input" type="number" name="basket_quantity" value="1" min="0" max="99" data-item_id="{{ product.id }}" id="productDetailQty">
                                   <!-- Am I allowed the same ID on different pages? -->
                                  <button class="btn" data-item_id="{{ item.item_id }}" id="increaseProductDetailQuantity">
                                                            <span>
                                                                <i class="fas fa-plus fa-sm"></i>
                                                            </span>
                                                        </button>  
                                </div>
                                        <h3>digital </h3>
        <p class="my-0">Digital photo? {{ item.digital_download }}</p>
                                        {% if item.product.product_type == 'photo' %}
                                         <select id="basket-item-delivery{{ forloop.counter0}}" name="basket_digital_download" class="">
                                            {% if item.digital_download == "on" %}
                                            <option value="None">Delivery</option>
                                            <option selected value="on">Digital Download</option>
                                            {% else %}
                                            <option selected value="None">Delivery</option>
                                            <option value="True">Digital Download</option>
                                              {% endif %}
                                        </select>
                                        {% else %}
                                            <!-- This is the same ID because only one will show at a time.  -->
                                            <div class="hide">
                                                <select id="basket-item-delivery{{ forloop.counter0}}" name="" class="extraClass hide">
                                                    <option value="" class="hide"></option>
                                                </select>
                                            </div>
                                        {% endif%}
                <h3>linked</h3>
                <div id="" class="">This is what youre test
                                     {% for image in item.item.linked_products %}
                                     {% if item.product.product_type == 'container' %}
                                        
                                        <select name="edit-linked-product" id="basket-linked-product" class=" py3">
                                        
                                        {% for product in products %} 
                                        {% if product.sku == image %}
                                           <option value="{{product.image_url_desktop}}|{{product.id}}|inventory" selected>{{product.friendly_name}}</option>
                                        {% endif%}  

                                        <option value="{{product.image_url_desktop}}|{{product.id}}|inventory">{{product.friendly_name}}</option>
                                        {% endfor %}
                                        <option value="" disabled>User Photos</option>
                                        {% for photo in user_photos %}
                                        {% if photo.sku == image %}
                                           <option value="{{photo.image}}|{{photo.id}}|upload" selected>Found upload</option>
                                        {% endif%} 
                                        <option value="{{photo.image}}|{{photo.id}}|upload">{{photo.title}}</option>                                   
                                        {% endfor %}
                                    </select>
                                     
                                   {% endif %}
                                {% endfor %}
                               </div>
                                    <button type="submit" class="btn btn-primary">Save changes</button>
                    </form>
      </div>
       <div class="modal-header">
        <h5><a href="{% url 'delete_basket_item' item.item.basket_item_id %}" class="modal-title" id="exampleModalLabel"><i class="fas fa-trash-alt"></i> Delete Basket Item</a></h5>
      </div>

    
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary reset-modal-body" data-dismiss="modal">Close</button>
   
      </div>
    </div>
  </div>
</div> 
   
      {% endfor %}

<div class="container">
    <div class="row">
         <div class="col-12">
            <a href="{% url 'empty_basket' %}"><i class="fas fa-trash-alt"></i> Empty basket</a>
        </div>
    </div>
    <div class="row">
        <div class="col-12 basket-summary-wrapper">
            <h6>Savings: £{{money_saved}}</h6>
            <h6><strong>Basket Total: £{{ total|floatformat:2 }}</strong></h6>
            <h6>Delivery: £{{ delivery|floatformat:2 }}</h6>
            <h4 class=""><strong>Grand Total: £{{ grand_total|floatformat:2 }}</strong></h4>
            {% if free_delivery_deficit > 0 %}
                <p class="mb-1 text-danger">
                    You could get free delivery by spending just <strong>£{{ free_delivery_deficit }}</strong> more!
                </p>
            {% endif %}
        </div>
    </div>
    <div class="row">
            <div class="col-12 checkout-button-wrapper">
                                    {% if are_all_items_linked == False %}
                                    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal">
                                    <span class="text-uppercase">Secure Checkout</span>
                                        <span class="icon">
                                            <i class="fas fa-lock"></i>
                                        </span>
                                    </button>
                                    {% else %}
                                    <a id="checkoutButton" href="{% url 'condensing_basket' %}" class="btn btn-black rounded-0 btn-lg">
                                        <span class="text-uppercase">Secure Checkout</span>
                                        <span class="icon">
                                            <i class="fas fa-lock"></i>
                                        </span>
                                    </a>
                                    
                            
                                    {% endif %}
            </div>
                                    <div class="col-12 checkout-button-wrapper">
                                        <a href="{% url 'products' %}" class="btn btn-outline-black rounded-0 btn-lg">
                                    <span class="icon">
                                    <i class="fas fa-chevron-left"></i>
                             </span>
                        <span class="text-uppercase">Keep Shopping</span>
                                         </a>
                        </div>
                </div> 
                </div>              
                {% else %}
                      
                    <p class="lead mb-5">Your bag is empty.</p>
                    <a href="{% url 'products' %}" class="btn btn-outline-black rounded-0 btn-lg">
                        <span class="icon">
                            <i class="fas fa-chevron-left"></i>
                        </span>
                        <span class="text-uppercase">Keep Shopping</span>
                    </a>
                {% endif %}
            </div>
        </div>
    </div>
    

   

 
<!-- Modal -->
    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        ...
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <a id="checkoutButton" href="{% url 'condensing_basket' %}" class="btn btn-black rounded-0 btn-lg">
                                        <span class="text-uppercase">Secure Checkout</span>
                                        <span class="icon">
                                            <i class="fas fa-lock"></i>
                                        </span>
                                    </a>
      </div>
    </div>
  </div>
</div>

{% endblock %}